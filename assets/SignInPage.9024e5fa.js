import{bB as y,bE as S,bx as f,bS as V,bR as x,bF as e,bU as i}from"./vendor.6ecb3d26.js";import{u as k,B as I,I as N,b as j,F as c,a as q,M as D,v as z,c as E,h as g}from"./index.9d54972a.js";import"./vant.a0d9ef90.js";const M=d=>{const t=y(d);return{ref:t,toggle:()=>t.value=!t.value,on:()=>t.value=!0,off:()=>t.value=!1}},L="_logo_19yz5_1",O="_icon_19yz5_8",R="_appName_19yz5_12",T="_preview_19yz5_18",r={logo:L,icon:O,appName:R,preview:T},H=S({setup:(d,t)=>{const b=k(),a=f({email:"",code:""}),s=f({email:[],code:[]}),p=y(),{ref:v,toggle:U,on:_,off:F}=M(!1),w=V(),u=x();u.query.preview==="yes"&&(a.email="guolong613@gmail.com",a.code="123456");const h=async o=>{var l;if(o.preventDefault(),Object.assign(s,{email:[],code:[]}),Object.assign(s,z(a,[{key:"email",type:"required",message:"\u5FC5\u586B"},{key:"email",type:"pattern",regex:/.+@.+/,message:"\u5FC5\u987B\u662F\u90AE\u7BB1\u5730\u5740"},{key:"code",type:"required",message:"\u5FC5\u586B"}])),!E(s)){const n=await g.post("/session",a,{_autoLoading:!0}).catch(m);localStorage.setItem("jwt",n.data.jwt);const C=(l=u.query.return_to)==null?void 0:l.toString();b.refreshMe(),w.push(C||"/")}},m=o=>{throw o.response.status===422&&Object.assign(s,o.response.data.errors),o},B=async()=>{_(),await g.post("/validation_codes",{email:a.email},{_autoLoading:!0}).catch(m).finally(F),p.value.startCount()};return()=>e(D,null,{title:()=>"\u767B\u5F55",icon:()=>e(I,null,null),default:()=>e("div",{class:r.wrapper},[e("div",{class:r.logo},[e(N,{class:r.icon,name:"leaf"},null),e("h1",{class:r.appName},[i("\u53F6\u5B50\u8BB0\u8D26")])]),e(j,{onSubmit:h},{default:()=>{var o,l;return[u.query.preview==="yes"&&e("div",{class:r.preview},[i("\u4F53\u9A8C\u8D26\u53F7\uFF0C\u53EF\u76F4\u63A5\u767B\u5F55")]),e(c,{label:"\u90AE\u7BB1\u5730\u5740",type:"text",placeholder:"\u8BF7\u8F93\u5165\u90AE\u7BB1\uFF0C\u7136\u540E\u70B9\u51FB\u53D1\u9001\u9A8C\u8BC1\u7801",modelValue:a.email,"onUpdate:modelValue":n=>a.email=n,error:(o=s.email)==null?void 0:o[0]},null),e(c,{ref:p,label:"\u9A8C\u8BC1\u7801",type:"validationCode",placeholder:"\u8BF7\u8F93\u5165\u516D\u4F4D\u6570\u5B57",countFrom:60,disabled:v.value,onClick:B,modelValue:a.code,"onUpdate:modelValue":n=>a.code=n,error:(l=s.code)==null?void 0:l[0]},null),e(c,{style:{paddingTop:"96px"}},{default:()=>[e(q,{type:"submit"},{default:()=>[i("\u767B\u5F55")]})]})]}})])})}});export{H as SignInPage,H as default};
